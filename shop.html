<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shop All - Accessories by Waydia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,400|Montserrat:400,500,700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
  <!-- EmailJS for notifications -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js"></script>
  <style>
    /* ...keep your existing CSS... */
    /* For brevity, your original CSS here */
  </style>
</head>
<body>
  <div id="app">
    <!-- ...keep your existing header/navbar/filter grid code... -->
    <!-- ... keep your existing product grid code ... -->

    <!-- Cart Modal -->
    <div v-if="showCart" class="cart-modal" @click.self="showCart = false">
      <div class="cart-content" @click.stop>
        <span class="close-btn" @click="showCart = false">&times;</span>
        <h2>Your Cart</h2>
        <ul class="cart-items" v-if="cart.length">
          <li v-for="(item, index) in cart" :key="item.id + '-' + (item.color || '')">
            <div>
              {{ item.name }}
              <span v-if="item.color"> ({{ item.color }})</span>
              - {{ formatPrice(item.price) }}
            </div>
            <div class="quantity-control">
              <button @click="decreaseQuantity(index)">−</button>
              <span>{{ item.quantity }}</span>
              <button @click="increaseQuantity(index)">+</button>
            </div>
            <button @click="removeFromCart(index)" title="Remove item" style="background:none; border:none; color:#cc6d8c; font-weight:bold; cursor:pointer;">×</button>
          </li>
        </ul>
        <p v-else>Your cart is empty.</p>
        <h3>Total: {{ formatPrice(cartTotal) }}</h3>
        <div class="cart-actions" v-if="cart.length">
          <button class="checkout-btn" @click="showCheckout = !showCheckout" v-if="!orderSuccess">
            {{ showCheckout ? 'Hide Checkout' : 'Checkout' }}
          </button>
        </div>
        <div v-if="showCheckout && cart.length && !orderSuccess">
          <form class="checkout-form" @submit.prevent="submitOrder">
            <label>
              Name:
              <input type="text" v-model="order.name" required />
            </label>
            <label>
              Email:
              <input type="email" v-model="order.email" required />
            </label>
            <label>
              Phone:
              <input type="tel" v-model="order.phone" required />
            </label>
            <label>
              Address:
              <input type="text" v-model="order.address" required />
            </label>
            <label>
              Shipping Method:
              <select v-model="order.shipping" required>
                <option disabled value="">Please select</option>
                <option :value="shippingOptions[0]">{{ shippingOptions[0].label }}</option>
                <option :value="shippingOptions[1]">{{ shippingOptions[1].label }}</option>
                <option :value="shippingOptions[2]">{{ shippingOptions[2].label }}</option>
                <option :value="shippingOptions[3]">{{ shippingOptions[3].label }}</option>
              </select>
            </label>
            <label>
              Payment Method:
              <select v-model="order.payment" required>
                <option disabled value="">Please select</option>
                <option value="lynk">Lynk Payment</option>
                <option value="paypal">PayPal</option>
                <option value="ncb">NCB Bank Transfer</option>
                <option value="cod">Cash on Delivery</option>
              </select>
            </label>
            <div v-if="order.payment === 'lynk'" style="margin:10px 0;">
              <b>Lynk Payment:</b>
              <a href="https://lynk-pay-link.example" target="_blank">Pay on Lynk</a>
              <!-- Replace with your actual Lynk link -->
            </div>
            <div v-if="order.payment === 'paypal'" style="margin:10px 0;">
              <b>PayPal:</b>
              <a href="https://paypal.me/yourpaypalusername" target="_blank">Pay on PayPal</a>
              <!-- Replace with your actual PayPal.me link -->
            </div>
            <div v-if="order.payment === 'ncb'" style="margin:10px 0;">
              <b>NCB Bank Transfer:</b>
              <br>Bank: NCB<br>Account Name: Accessories by Waydia<br>Account Number: 123456789<br>Branch: Spanish Town<br>
              <!-- Replace with your actual details -->
            </div>
            <div v-if="order.payment === 'cod'" style="margin:10px 0;">
              <b>Cash on Delivery selected. Please have exact change ready.</b>
            </div>
            <h4>Shipping: {{ formatPrice(selectedShippingCost) }}</h4>
            <h3>Grand Total: {{ formatPrice(cartTotal + selectedShippingCost) }}</h3>
            <button type="submit" class="checkout-btn" style="margin-top:1rem;">
              Place Order & Pay
            </button>
          </form>
        </div>
        <div v-if="orderSuccess" class="payment-success">
          Thank you! Your order was submitted.<br>
          We'll contact you soon.
        </div>
      </div>
    </div>
  </div>
  <script>
    // EmailJS init (replace with your user ID)
    emailjs.init('YOUR_EMAILJS_USER_ID'); // <-- Replace with your EmailJS user ID

    new Vue({
      el: '#app',
      data: {
        currency: 'JMD',
        showCart: false,
        showCheckout: false,
        orderSuccess: false,
        filters: {
          type: '',
          maxPrice: Infinity,
          search: ''
        },
        user: {
          loggedIn: false,
          username: '',
          password: ''
        },
        products: [
          // ... your products ...
        ],
        cart: [],
        order: {
          name: "",
          email: "",
          phone: "",
          address: "",
          shipping: "",
          payment: ""
        },
        shippingOptions: [
          { label: "Spanish Town – 300 JMD", value: 300, currency: "JMD" },
          { label: "Post-to-Door – 1000 JMD", value: 1000, currency: "JMD" },
          { label: "Zip Mail Post-to-Post – 700 JMD", value: 700, currency: "JMD" },
          { label: "International – 9 USD", value: 9, currency: "USD" }
        ]
      },
      computed: {
        filteredProducts() {
          return this.products.filter(product => {
            const matchesType = !this.filters.type || product.type === this.filters.type;
            const matchesPrice = product.price <= this.filters.maxPrice;
            const matchesSearch = !this.filters.search ||
              product.name.toLowerCase().includes(this.filters.search.toLowerCase());
            return matchesType && matchesPrice && matchesSearch;
          });
        },
        cartTotal() {
          return this.cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
        },
        totalQuantity() {
          return this.cart.reduce((acc, item) => acc + item.quantity, 0);
        },
        selectedShippingCost() {
          if (!this.order.shipping) return 0;
          // Find the selected shipping option
          let selected = this.order.shipping;
          if (selected.currency === "USD") {
            // Convert to JMD for grand total if needed
            return this.currency === "USD" ? selected.value : selected.value * 150;
          }
          return selected.value;
        }
      },
      methods: {
        formatPrice(price) {
          let converted = price;
          let symbol = "J$";
          if (this.currency === "USD") {
            converted = price / 150;
            symbol = "$";
          }
          return symbol + converted.toFixed(2);
        },
        addToCart(product) {
          if (!this.user.loggedIn) {
            alert("Please login to add items to cart.");
            return;
          }
          const color = product.selectedColor || '';
          const id = product.id + (color ? '-' + color : '');
          const item = this.cart.find(i => i.id === id);
          if (item) {
            if (item.quantity < product.stock) item.quantity++;
          } else {
            this.cart.push({
              id: id,
              name: product.name,
              price: product.price,
              quantity: 1,
              color: color,
              stock: product.stock
            });
          }
          this.showCart = true;
        },
        removeFromCart(index) {
          this.cart.splice(index, 1);
        },
        increaseQuantity(index) {
          const item = this.cart[index];
          if (item.quantity < item.stock) item.quantity++;
        },
        decreaseQuantity(index) {
          const item = this.cart[index];
          if (item.quantity > 1) item.quantity--;
        },
        login() {
          if (this.user.username && this.user.password) {
            this.user.loggedIn = true;
            this.user.password = '';
            alert("Logged in as " + this.user.username);
          } else {
            alert("Please enter username and password.");
          }
        },
        logout() {
          this.user.loggedIn = false;
          this.user.username = '';
          this.user.password = '';
          this.cart = [];
          this.showCart = false;
        },
        submitOrder() {
          if (
            !this.order.name ||
            !this.order.email ||
            !this.order.phone ||
            !this.order.address ||
            !this.order.shipping ||
            !this.order.payment
          ) {
            alert("Please fill out all fields.");
            return;
          }
          // Prepare order details for email
          const orderDetails = `
            Name: ${this.order.name}
            Email: ${this.order.email}
            Phone: ${this.order.phone}
            Address: ${this.order.address}
            Shipping: ${this.order.shipping.label}
            Payment: ${this.order.payment}
            Cart: ${this.cart.map(i => `${i.name}${i.color ? ' ('+i.color+')' : ''} x${i.quantity}`).join(', ')}
            Item Total: ${this.formatPrice(this.cartTotal)}
            Shipping: ${this.formatPrice(this.selectedShippingCost)}
            Grand Total: ${this.formatPrice(this.cartTotal + this.selectedShippingCost)}
          `;
          // Send email notification using EmailJS
          emailjs.send('service_qpk2hk8', 'template_qd12s7x', {
            to_email: 'mcleodwaydia@gmail.com', // <-- Replace with your email
            from_name: this.order.name,
            from_email: this.order.email,
            message: orderDetails
          })
          .then(() => {
            this.orderSuccess = true;
            setTimeout(() => {
              this.cart = [];
              this.showCheckout = false;
              this.orderSuccess = false;
              this.showCart = false;
              this.order = { name: "", email: "", phone: "", address: "", shipping: "", payment: "" };
            }, 3500);
          }, () => {
            alert("Order placed but failed to send notification. Please check EmailJS setup.");
            this.orderSuccess = true;
            setTimeout(() => {
              this.cart = [];
              this.showCheckout = false;
              this.orderSuccess = false;
              this.showCart = false;
              this.order = { name: "", email: "", phone: "", address: "", shipping: "", payment: "" };
            }, 3500);
          });
        }
      }
    });
  </script>
</body>
</html>
