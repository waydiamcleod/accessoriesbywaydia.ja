<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shop All - Accessories by Waydia</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,400|Montserrat:400,500,700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@2.6.4/dist/email.min.js"></script>
  <style>
    /* ... (Your CSS styles here, unchanged) ... */
    body {margin:0;padding:0;font-family:'Montserrat',Arial,sans-serif;background:#fffaf7;color:#7c5e3c;}
    /* ... rest of your CSS ... */
  </style>
</head>
<body>
  <div id="app">
    <header class="navbar">
      <div class="logo">Accessories by Waydia</div>
      <ul class="nav-links">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li class="cart-icon" @click="showCart = true" title="View Cart">
          ðŸ›’
          <span v-if="cart.length" class="cart-count">{{ totalQuantity }}</span>
        </li>
        <li>
          <div class="user-auth" v-if="!user.loggedIn">
            <input type="text" v-model="user.username" placeholder="Username" @keyup.enter="login" />
            <input type="password" v-model="user.password" placeholder="Password" @keyup.enter="login" />
            <button @click="login">Login</button>
          </div>
          <div v-else class="user-auth">
            <span class="user-info">Hello, {{ user.username }}!</span>
            <button @click="logout">Logout</button>
          </div>
        </li>
      </ul>
    </header>

    <section class="filters">
      <label>
        Filter by type:
        <select v-model="filters.type">
          <option value="">All</option>
          <option value="keychain">Keychain</option>
          <option value="clawclip">Claw Clip</option>
        </select>
      </label>
      <label>
        Filter by max price:
        <select v-model.number="filters.maxPrice">
          <option :value="Infinity">No limit</option>
          <option :value="500">500 JMD</option>
          <option :value="850">850 JMD</option>
          <option :value="1000">1000 JMD</option>
        </select>
      </label>
      <label>
        Currency:
        <select v-model="currency">
          <option value="JMD">JMD</option>
          <option value="USD">USD</option>
        </select>
      </label>
      <label>
        Search:
        <input type="text" v-model="filters.search" placeholder="Search products..." />
      </label>
    </section>

    <section class="shop-grid">
      <div
        v-for="product in filteredProducts"
        :key="product.id + (product.selectedColor || '')"
        class="product-card"
      >
        <a
          :href="product.image"
          target="_blank"
          v-if="product.stock > 0"
        ><img
            :src="product.image"
            :alt="product.name"
          /></a>
        <img
          v-else
          :src="product.image"
          :alt="product.name"
          style="opacity: 0.5; cursor: not-allowed;"
        />
        <h3>{{ product.name }}</h3>
        <p>
          {{ formatPrice(product.price) }}
          <span class="stock-info" v-if="product.stock <= 5 && product.stock > 0"
            >Only {{ product.stock }} left!</span>
          <span class="stock-info" v-if="product.stock === 0">Out of stock</span>
        </p>
        <div v-if="product.type === 'clawclip'">
          <label>
            Color:
            <select v-model="product.selectedColor">
              <option
                v-for="color in product.colors"
                :key="color"
                :value="color"
              >
                {{ color }}
              </option>
            </select>
          </label>
        </div>
        <button
          class="btn-buy"
          @click="addToCart(product)"
          :disabled="product.stock === 0"
        >
          Add to Cart
        </button>
      </div>
    </section>

    <div v-if="showCart" class="cart-modal" @click.self="showCart = false">
      <div class="cart-content" @click.stop>
        <span class="close-btn" @click="showCart = false">&times;</span>
        <h2>Your Cart</h2>
        <ul class="cart-items" v-if="cart.length">
          <li v-for="(item, index) in cart" :key="item.id + '-' + (item.color || '')">
            <div>
              {{ item.name }}
              <span v-if="item.color"> ({{ item.color }})</span>
              - {{ formatPrice(item.price) }}
            </div>
            <div class="quantity-control">
              <button @click="decreaseQuantity(index)">âˆ’</button>
              <span>{{ item.quantity }}</span>
              <button @click="increaseQuantity(index)">+</button>
            </div>
            <button @click="removeFromCart(index)" title="Remove item" style="background:none; border:none; color:#cc6d8c; font-weight:bold; cursor:pointer;">Ã—</button>
          </li>
        </ul>
        <p v-else>Your cart is empty.</p>
        <h3>Total: {{ formatPrice(cartTotal) }}</h3>
        <div class="cart-actions" v-if="cart.length">
          <button class="checkout-btn" @click="showCheckout = !showCheckout" v-if="!orderSuccess">
            {{ showCheckout ? 'Hide Checkout' : 'Checkout' }}
          </button>
        </div>
        <div v-if="showCheckout && cart.length && !orderSuccess">
          <form class="checkout-form" @submit.prevent="submitOrder">
            <label>
              Name:
              <input type="text" v-model="order.name" required />
            </label>
            <label>
              Email:
              <input type="email" v-model="order.email" required />
            </label>
            <label>
              Phone:
              <input type="tel" v-model="order.phone" required />
            </label>
            <label>
              Address:
              <input type="text" v-model="order.address" required />
            </label>
            <label>
              Shipping Method:
              <select v-model="order.shipping" required>
                <option disabled value="">Please select</option>
                <option v-for="option in shippingOptions" :key="option.label" :value="option.label">{{ option.label }}</option>
              </select>
            </label>
            <label>
              Payment Method:
              <select v-model="order.payment" required>
                <option disabled value="">Please select</option>
                <option value="lynk">Lynk Payment</option>
                <option value="paypal">PayPal</option>
                <option value="ncb">NCB Bank Transfer</option>
                <option value="cod">Cash on Delivery</option>
              </select>
            </label>
            <label>
              Notes (optional):
              <input type="text" v-model="order.notes" placeholder="Any notes about your order?" />
            </label>
            <div v-if="order.payment === 'lynk'" style="margin:10px 0;">
              <b>Lynk Payment:</b>
              <a href="https://deep.lynk.us/6Eae" target="_blank">Pay on Lynk</a>
            </div>
            <div v-if="order.payment === 'paypal'" style="margin:10px 0;">
              <b>PayPal:</b>
              <a href="https://www.paypal.me/WaydiaMcLeod" target="_blank">Pay on PayPal</a>
            </div>
            <div v-if="order.payment === 'ncb'" style="margin:10px 0;">
              <b>NCB Bank Transfer:</b>
              <br>Bank: NCB<br>Account Name: Waydia McLeod<br>Account Number: 475001613<br>Branch: St.Jago Shopping Center Branch<br>
            </div>
            <div v-if="order.payment === 'cod'" style="margin:10px 0;">
              <b>Cash on Delivery selected. Please have exact change ready.</b>
            </div>
            <h4>Shipping: {{ formatPrice(selectedShippingCost) }}</h4>
            <h3>Grand Total: {{ formatPrice(cartTotal + selectedShippingCost) }}</h3>
            <button type="submit" class="checkout-btn" style="margin-top:1rem;">
              Place Order & Pay
            </button>
          </form>
        </div>
        <div v-if="orderSuccess" class="payment-success">
          Thank you! Your order was submitted.<br>
          We'll contact you soon.
        </div>
      </div>
    </div>
  </div>
  <script>
    // --------- EmailJS Initialization (use your public key here!) ---------
    emailjs.init('yEYlWETvh08w892PT'); // <-- This is your public key (user/public key)

    new Vue({
      el: '#app',
      data: {
        currency: 'JMD',
        showCart: false,
        showCheckout: false,
        orderSuccess: false,
        filters: {
          type: '',
          maxPrice: Infinity,
          search: ''
        },
        user: {
          loggedIn: false,
          username: '',
          password: ''
        },
        products: [
          {id: 1, name: 'Pearl Bow Heart Keychain', price: 800, type: 'keychain', image: 'https://github.com/waydiamcleod/accessoriesbywaydia.ja/blob/main/%F0%9F%96%A4%F0%9F%94%97.jpg?raw=true', stock: 10},
          {id: 2, name: 'Puppy Teddy Pendant', price: 1000, type: 'keychain', image: 'https://raw.githubusercontent.com/waydiamcleod/accessoriesbywaydia.ja/refs/heads/main/H78c602610c1c4a27b48322f6a0ac9b8be.webp', stock: 10},
          {id: 3, name: 'Batman Lego Keychain', price: 850, type: 'keychain', image: 'https://github.com/waydiamcleod/accessoriesbywaydia.ja/blob/main/Lego%20Accessories%20_%20Pink%20Batman%20Keychain%20_%20Color_%20Black_Pink%20_%20Size_%20Os.jpg?raw=true', stock: 10, colors: ['Pink','Black'], selectedColor: ''},
          {id: 4, name: 'Miu Style Cat Head Keychain', price: 1000, type: 'keychain', image: 'https://raw.githubusercontent.com/waydiamcleod/accessoriesbywaydia.ja/refs/heads/main/H4b7310a3a1dc460cb166048ca80bf69e0.webp', stock: 6},
          {id: 5, name: 'Miu Style Heart Shaped Keychain', price: 1000, type: 'keychain', image: 'https://raw.githubusercontent.com/waydiamcleod/accessoriesbywaydia.ja/refs/heads/main/H6eba452254fe438f8e74a90b6a434b87n.webp', stock: 6},
          {id: 6, name: 'Dachshund', price: 1000, type: 'keychain', image: 'https://github.com/waydiamcleod/accessoriesbywaydia.ja/blob/main/Iplaynox%20Braided%20Rope%20Keychain%20Pendant%20%E2%80%93%20High-Grade%20Dachshund%20Pendant%20for%20Phone%20Bag%20Accessories%20Style%20A.jpg?raw=true', stock: 3},
          {id: 7, name: 'Tennis Racket Keychain', price: 1000, type: 'keychain', image: 'https://raw.githubusercontent.com/waydiamcleod/accessoriesbywaydia.ja/refs/heads/main/H7deef4f9cf394e708254b291e3610bf7w.webp', stock: 3},
          {id: 8, name: 'Tennis Racket Keychain + Bible', price: 1100, type: 'keychain', image: 'https://raw.githubusercontent.com/waydiamcleod/accessoriesbywaydia.ja/refs/heads/main/H4082d5e9abc343d796c724005550d886h.webp', stock: 4},
          {id: 9, name: 'Flower Claw Clip', price: 500, type: 'clawclip', image: 'https://github.com/waydiamcleod/accessoriesbywaydia.ja/blob/main/flower%20hair%20clips.jpg?raw=true', stock: 20, colors: ['Pink','White','Burgundy','Yellow','Orange','Green','Purple'], selectedColor: ''}
        ],
        cart: [],
        order: {
          name: "",
          email: "",
          phone: "",
          address: "",
          shipping: "",
          payment: "",
          notes: ""
        },
        shippingOptions: [
          { label: "Spanish Town â€“ 300 JMD", value: 300, currency: "JMD" },
          { label: "Zip Mail Post-to-Door â€“ 1000 JMD", value: 1000, currency: "JMD" },
          { label: "Zip Mail Post-to-Post â€“ 700 JMD", value: 700, currency: "JMD" },
          { label: "International â€“ 9 USD", value: 9, currency: "USD" }
        ]
      },
      computed: {
        filteredProducts() {
          return this.products.filter(product => {
            const matchesType = !this.filters.type || product.type === this.filters.type;
            const matchesPrice = product.price <= this.filters.maxPrice;
            const matchesSearch = !this.filters.search ||
              product.name.toLowerCase().includes(this.filters.search.toLowerCase());
            return matchesType && matchesPrice && matchesSearch;
          });
        },
        cartTotal() {
          return this.cart.reduce((acc, item) => acc + item.price * item.quantity, 0);
        },
        totalQuantity() {
          return this.cart.reduce((acc, item) => acc + item.quantity, 0);
        },
        selectedShippingCost() {
          if (!this.order.shipping) return 0;
          let selected = this.shippingOptions.find(opt => opt.label === this.order.shipping);
          if (!selected) return 0;
          if (selected.currency === "USD") {
            return this.currency === "USD" ? selected.value : selected.value * 150;
          }
          return selected.value;
        }
      },
      methods: {
        formatPrice(price) {
          let converted = price;
          let symbol = "J$";
          if (this.currency === "USD") {
            converted = price / 150;
            symbol = "$";
          }
          return symbol + converted.toFixed(2);
        },
        addToCart(product) {
          if (!this.user.loggedIn) {
            alert("Please login to add items to cart.");
            return;
          }
          const color = product.selectedColor || '';
          const id = product.id + (color ? '-' + color : '');
          const item = this.cart.find(i => i.id === id);
          if (item) {
            if (item.quantity < product.stock) item.quantity++;
          } else {
            this.cart.push({
              id: id,
              name: product.name,
              price: product.price,
              quantity: 1,
              color: color,
              stock: product.stock
            });
          }
          this.showCart = true;
        },
        removeFromCart(index) {
          this.cart.splice(index, 1);
        },
        increaseQuantity(index) {
          const item = this.cart[index];
          if (item.quantity < item.stock) item.quantity++;
        },
        decreaseQuantity(index) {
          const item = this.cart[index];
          if (item.quantity > 1) item.quantity--;
        },
        login() {
          if (this.user.username && this.user.password) {
            this.user.loggedIn = true;
            this.user.password = '';
            alert("Logged in as " + this.user.username);
          } else {
            alert("Please enter username and password.");
          }
        },
        logout() {
          this.user.loggedIn = false;
          this.user.username = '';
          this.user.password = '';
          this.cart = [];
          this.showCart = false;
        },
        submitOrder() {
          if (
            !this.order.name ||
            !this.order.email ||
            !this.order.phone ||
            !this.order.address ||
            !this.order.shipping ||
            !this.order.payment
          ) {
            alert("Please fill out all fields.");
            return;
          }

          // Compose order details for the email
          const orderDetails = `
Name: ${this.order.name}
Email: ${this.order.email}
Phone: ${this.order.phone}
Address: ${this.order.address}
Shipping: ${this.order.shipping}
Payment: ${this.order.payment}
Cart: ${this.cart.map(i => `${i.name}${i.color ? ' ('+i.color+')' : ''} x${i.quantity}`).join(', ')}
Item Total: ${this.formatPrice(this.cartTotal)}
Shipping: ${this.formatPrice(this.selectedShippingCost)}
Grand Total: ${this.formatPrice(this.cartTotal + this.selectedShippingCost)}
          `;

          const now = new Date();
          const formattedTime = now.toLocaleString();

          // --------- Correct EmailJS send call --------
          // service id, template id, and template parameters
          // Replace 'service_qpk2hk8' with your actual service ID from EmailJS dashboard
          emailjs.send('service_qpk2hk8', 'template_qd12s7x', {
            customer_name: this.order.name,
            customer_email: this.order.email,
            product_name: this.cart.map(i => i.name).join(', '),
            quantity: this.cart.reduce((sum, i) => sum + i.quantity, 0),
            shipping_method: this.order.shipping,
            notes: this.order.notes || '',
            message: orderDetails,
            time: formattedTime,
            name: this.order.name
          })
          .then(() => {
            this.orderSuccess = true;
            setTimeout(() => {
              this.cart = [];
              this.showCheckout = false;
              this.orderSuccess = false;
              this.showCart = false;
              this.order = { name: "", email: "", phone: "", address: "", shipping: "", payment: "", notes: "" };
            }, 3500);
          })
          .catch((error) => {
            alert("Order placed but failed to send notification. Error: " + (error?.text || JSON.stringify(error)));
            this.orderSuccess = true;
            setTimeout(() => {
              this.cart = [];
              this.showCheckout = false;
              this.orderSuccess = false;
              this.showCart = false;
              this.order = { name: "", email: "", phone: "", address: "", shipping: "", payment: "", notes: "" };
            }, 3500);
          });
        }
      }
    });
  </script>
</body>
</html>
